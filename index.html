<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" href="https://github.com/jkyl.png">
  <title>jkyl</title>
  <style>
    :root {
      --bg: #282828;
      --bg1: #3c3836;
      --bg2: #504945;
      --fg: #ebdbb2;
      --fg-dim: #a89984;
      --red: #fb4934;
      --green: #b8bb26;
      --yellow: #fabd2f;
      --blue: #83a598;
      --purple: #d3869b;
      --aqua: #8ec07c;
      --orange: #fe8019;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: var(--bg);
      color: var(--fg);
      font-family: "SF Mono", "Fira Code", "Consolas", monospace;
      font-size: 14px;
      line-height: 1.6;
      min-height: 100vh;
      padding: 2rem;
      max-width: 80ch;
      margin: 0 auto;
    }

    header {
      margin-bottom: 2rem;
      border-bottom: 1px solid var(--bg2);
      padding-bottom: 1rem;
    }

    h1 {
      color: var(--green);
      font-weight: normal;
      font-size: 1.2rem;
    }

    h1::before {
      content: "~ ";
      color: var(--fg-dim);
    }

    .contact {
      margin-top: 0.5rem;
      color: var(--fg-dim);
    }

    .contact a {
      color: var(--blue);
      text-decoration: none;
    }

    .contact a:hover {
      text-decoration: underline;
    }

    nav {
      margin-top: 1rem;
      display: flex;
      gap: 1rem;
    }

    nav a {
      color: var(--fg-dim);
      text-decoration: none;
    }

    nav a:hover,
    nav a.active {
      color: var(--yellow);
    }

    nav a:hover span,
    nav a.active span {
      text-decoration: underline;
    }

    nav a::before {
      content: "[";
      color: var(--bg2);
    }

    nav a::after {
      content: "]";
      color: var(--bg2);
    }

    main {
      margin-top: 2rem;
    }

    section {
      display: none;
    }

    section.active {
      display: block;
    }

    h2 {
      color: var(--aqua);
      font-weight: normal;
      font-size: 1rem;
      margin-bottom: 1rem;
      position: relative;
    }

    h2::before {
      content: "## ";
      color: var(--fg-dim);
    }

    .job {
      margin-bottom: 1rem;
    }

    .job-header {
      color: var(--orange);
    }

    .job-header a {
      color: inherit;
      text-decoration: none;
    }

    .job-header a:hover {
      text-decoration: underline;
    }

    .job-meta {
      color: var(--fg-dim);
    }

    .job-meta::before {
      content: " / ";
    }

    .job-desc {
      color: var(--fg-dim);
      margin-top: 0.25rem;
      border-left: 3px solid var(--bg2);
      padding-left: 1rem;
      opacity: 0.7;
    }

    .player {
      background: var(--bg1);
      padding: 1rem;
      margin-bottom: 1rem;
    }

    .player-status {
      color: var(--fg-dim);
      margin-bottom: 0.5rem;
    }

    .player-title {
      color: var(--green);
      margin-bottom: 1rem;
    }

    .player-controls {
      display: flex;
      gap: 0.5rem;
      align-items: center;
      flex-wrap: wrap;
    }

    .player-controls button {
      background: var(--bg2);
      color: var(--fg);
      border: none;
      padding: 0.5rem 1rem;
      font-family: inherit;
      font-size: inherit;
      cursor: pointer;
      transition: background 0.15s;
    }

    .player-controls button:hover {
      background: var(--bg);
    }

    .player-controls button.active {
      color: var(--green);
    }

    .player audio {
      width: 100%;
      height: 32px;
      margin-top: 0.5rem;
    }

    .tracklist {
      margin-top: 1rem;
    }

    .track {
      color: var(--fg-dim);
      cursor: pointer;
      text-decoration: none;
      width: fit-content;
    }

    .track:hover {
      text-decoration: underline;
    }

    .track.active {
      color: var(--green);
    }

    footer {
      margin-top: 3rem;
      padding-top: 1rem;
      border-top: 1px solid var(--bg2);
      color: var(--fg-dim);
      font-size: 0.85rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>jkyl <span style="color: var(--fg-dim); font-weight: normal;">/ Jon Kyl / NYC</span></h1>
    <nav>
      <a href="#cv" class="active"><span>cv</span></a>
      <a href="#portfolio"><span>portfolio</span></a>
      <a href="#music"><span>music</span></a>
      <a href="#contact"><span>contact</span></a>
    </nav>
  </header>

  <main>
    <section id="cv" class="active">
      <h2>blurb</h2>
      <p style="color: var(--fg-dim);">Research engineer with 8+ years in generative AI. Expert in diffusion models, large-scale pretraining, and real-time inference.</p>

      <h2 style="margin-top: 2rem;">employment</h2>
      <div class="job">
        <div class="job-header"><a href="https://mirage.app">Mirage</a> <span class="job-meta">Research Engineer, 2025-present</span></div>
        <div class="job-desc">Multimodal foundation models. Diffusion-based VAEs. Reward models. Streaming dataloaders.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://unity.com">Unity</a> <span class="job-meta">Senior ML Engineer, 2019-2025</span></div>
        <div class="job-desc">Diffusion models for 3D textures. Inverse rendering. Conditional GANs for terrain generation.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://huawei.com">Huawei</a> <span class="job-meta">Senior ML Engineer, 2018-2019</span></div>
        <div class="job-desc">Real-time video super-resolution on mobile. Raytracing denoising. Dev tools for NPUs.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://www.linkedin.com/company/avvir">Avvir</a> <span class="job-meta">ML Engineer, 2017-2018</span></div>
        <div class="job-desc">Semantic segmentation on pointclouds. 3D mesh registration. Anomaly detection for construction QA.</div>
      </div>

      <h2 style="margin-top: 2rem;">education</h2>
      <div class="job">
        <div class="job-header"><a href="https://uchicago.edu">University of Chicago</a> <span class="job-meta">B.A. Physics with Honors, 2012-2016</span></div>
        <div class="job-desc">Thesis on ground-based CMB astronomy. Graduate coursework in computer science. Research assistant in multidisciplinary genAI lab.</div>
      </div>
    </section>

    <section id="portfolio">
      <h2>projects</h2>
      <div class="job">
        <div class="job-header"><a href="https://github.com/jkyl/just-image-transformer">just-image-transformer</a></div>
        <div class="job-desc">Diffusion transformer trained directly in image space via x-prediction.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://github.com/jkyl/nnx-gru">nnx-gru</a></div>
        <div class="job-desc">Linear RNN language model combining parallelized training and linear-time inference.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://github.com/jkyl/vq-vae">vq-vae</a></div>
        <div class="job-desc">Vector-quantized autoencoder for compressing raw audio into discrete codes.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://github.com/jkyl/biggan">biggan</a></div>
        <div class="job-desc">Class-conditional image GAN following the seminal paper.</div>
      </div>
      <div class="job">
        <div class="job-header"><a href="https://huggingface.co/datasets/jon-kyl/imagenet-sdxl-quantized">imagenet-sdxl-quantized</a></div>
        <div class="job-desc">ImageNet pre-encoded with SDXL VAE and quantized using an optimized nonlinearity.</div>
      </div>
    </section>

    <section id="music">
      <div id="music-auth">
        <input type="password" id="music-password" placeholder="password" style="background: var(--bg1); border: 1px solid var(--bg2); color: var(--fg); padding: 0.5rem; font-family: inherit; font-size: 16px; width: 200px;">
        <button id="music-submit" style="background: var(--bg2); color: var(--fg); border: none; padding: 0.5rem 1rem; font-family: inherit; font-size: inherit; cursor: pointer; margin-left: 0.5rem;">⏎</button>
        <p id="music-error" style="color: var(--red); margin-top: 0.5rem; display: none;">incorrect password</p>
      </div>
      <div id="music-content" style="display: none;">
        <h2>dj mixes</h2>
        <div class="player" id="mix-player">
          <div class="player-title">--</div>
          <div class="player-controls">
            <button class="prev">⏮</button>
            <button class="next">⏭</button>
            <button class="shuffle">⤮</button>
          </div>
        </div>
        <div class="tracklist" id="mix-tracklist"></div>

        <h2 style="margin-top: 2rem;">original tunes</h2>
        <div class="player" id="tunes-player">
          <div class="player-title">--</div>
          <div class="player-controls">
            <button class="prev">⏮</button>
            <button class="next">⏭</button>
            <button class="shuffle">⤮</button>
          </div>
        </div>
        <div class="tracklist" id="tunes-tracklist"></div>
      </div>
    </section>

    <section id="contact">
      <h2>contact</h2>
      <div class="contact">
        <div>[<a href="mailto:jonathan5kyl@gmail.com">email</a>](mailto:jonathan5kyl@gmail.com)</div>
        <div>[<a href="https://github.com/jkyl">github</a>](github.com/jkyl)</div>
        <div>[<a href="https://linkedin.com/in/j-kyl">linkedin</a>](linkedin.com/in/j-kyl)</div>
        <div>[<a href="https://huggingface.co/jon-kyl">huggingface</a>](huggingface.co/jon-kyl)</div>
      </div>
    </section>
  
  </main>

  <audio id="audio" controls crossorigin="use-credentials" style="display:none"></audio>

  <footer>
    <span>EOF</span>
  </footer>

  <script>
    async function hashPassword(password) {
      const data = new TextEncoder().encode(password);
      const hash = await crypto.subtle.digest('SHA-256', data);
      return Array.from(new Uint8Array(hash)).map(b => b.toString(16).padStart(2, '0')).join('');
    }

    function unlockMusic() {
      document.getElementById('music-auth').style.display = 'none';
      document.getElementById('music-content').style.display = 'block';
      localStorage.setItem('music-unlocked', 'true');
    }

    // Check if session is still valid
    async function checkSession() {
      if (localStorage.getItem('music-unlocked') !== 'true') return;
      try {
        const res = await fetch('https://audio.jkyl.io/mixes/index.jsonl', { credentials: 'include' });
        if (res.ok) {
          unlockMusic();
        } else {
          localStorage.removeItem('music-unlocked');
        }
      } catch {
        localStorage.removeItem('music-unlocked');
      }
    }
    checkSession();

    async function tryUnlock() {
      const password = document.getElementById('music-password').value;
      const hash = await hashPassword(password);
      const res = await fetch('https://audio.jkyl.io/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'include',
        body: JSON.stringify({ hash })
      });
      if (res.ok) {
        localStorage.setItem('music-unlocked', 'true');
        location.reload();
      } else {
        document.getElementById('music-error').style.display = 'block';
      }
    }

    document.getElementById('music-password').addEventListener('keypress', (e) => {
      if (e.key === 'Enter') tryUnlock();
    });

    document.getElementById('music-submit').addEventListener('click', tryUnlock);

    // Navigation with proper URL hash support
    const navLinks = document.querySelectorAll('nav a');
    const sections = document.querySelectorAll('section');

    function showSection(id) {
      navLinks.forEach(l => l.classList.toggle('active', l.getAttribute('href') === '#' + id));
      sections.forEach(s => s.classList.toggle('active', s.id === id));
      // Preload the first station for this section if no station is active
      if (!activeStation) {
        for (const stationId in stations) {
          if (stations[stationId].section === id) {
            preloadStation(stations[stationId]);
            break;
          }
        }
      }
    }

    navLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        const target = link.getAttribute('href').slice(1);
        showSection(target);
        history.pushState(null, '', '#' + target);
        e.preventDefault();
      });
    });

    window.addEventListener('hashchange', () => {
      showSection(location.hash.slice(1) || 'contact');
    });

    // Audio player with single shared element
    const audio = document.getElementById('audio');
    let activeStation = null;

    // Save player state for persistence
    function savePlayerState() {
      if (activeStation && activeStation.currentIdx >= 0) {
        localStorage.setItem('player-state', JSON.stringify({
          stationId: activeStation.id,
          trackIdx: activeStation.currentIdx,
          position: audio.currentTime,
          playing: !audio.paused
        }));
      }
    }

    // Save state periodically and on unload
    setInterval(savePlayerState, 1000);
    window.addEventListener('beforeunload', () => {
      savePlayerState();
      audio.pause();
      audio.oncanplay = null;
      audio.onerror = null;
      audio.src = '';
    });

    const stationConfigs = [
      { id: 'mix', playerId: 'mix-player', tracklistId: 'mix-tracklist', path: 'https://audio.jkyl.io/mixes', json: 'https://audio.jkyl.io/mixes/index.jsonl', section: 'music' },
      { id: 'tunes', playerId: 'tunes-player', tracklistId: 'tunes-tracklist', path: 'https://audio.jkyl.io/original-tunes', json: 'https://audio.jkyl.io/original-tunes/index.jsonl', section: 'music' }
    ];

    const stations = {};

    function shuffle(arr) {
      const a = [...arr];
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    function initStation(cfg) {
      const container = document.getElementById(cfg.playerId);
      const tracklist = document.getElementById(cfg.tracklistId);
      const title = container.querySelector('.player-title');
      const shuffleBtn = container.querySelector('.shuffle');

      const station = {
        id: cfg.id,
        section: cfg.section,
        path: cfg.path,
        tracks: [],
        currentIdx: -1,
        shuffleOrder: [],
        shufflePos: 0,
        shuffleOn: false,
        container, tracklist, title, shuffleBtn
      };

      container.querySelector('.prev').onclick = () => move(station, -1);
      container.querySelector('.next').onclick = () => move(station, 1);
      shuffleBtn.onclick = () => {
        station.shuffleOn = !station.shuffleOn;
        shuffleBtn.classList.toggle('active', station.shuffleOn);
        if (station.shuffleOn && station.tracks.length) {
          station.shuffleOrder = shuffle([...Array(station.tracks.length).keys()]);
          station.shufflePos = 0;
        }
      };

      fetch(cfg.json, { credentials: 'include' })
        .then(r => r.text())
        .then(text => text.trim().split('\n').filter(line => line).map(line => JSON.parse(line)))
        .then(tracks => {
          station.tracks = tracks;
          station.shuffleOrder = shuffle([...Array(tracks.length).keys()]);
          station.shufflePos = 0;
          render(station);

          // Restore saved state if this is the station that was playing
          const saved = localStorage.getItem('player-state');
          if (saved) {
            try {
              const state = JSON.parse(saved);
              if (state.stationId === station.id && state.trackIdx < tracks.length) {
                loadTrack(station, state.trackIdx, false);
                audio.addEventListener('loadedmetadata', function restore() {
                  audio.removeEventListener('loadedmetadata', restore);
                  audio.currentTime = state.position || 0;
                  if (state.playing) {
                    audio.play().catch(() => {});
                  }
                });
                return; // Skip preload since we restored
              }
            } catch (e) {}
          }

          // Preload if this station's section is currently active and no station loaded yet
          const currentSection = location.hash.slice(1) || 'contact';
          if (station.section === currentSection && !activeStation) {
            preloadStation(station);
          }
        })
        .catch(() => {});

      return station;
    }

    function render(station) {
      station.tracklist.innerHTML = station.tracks.map((t, i) =>
        `<div class="track${i === station.currentIdx && activeStation === station ? ' active' : ''}" data-i="${i}">${t.title}</div>`
      ).join('');
      station.tracklist.querySelectorAll('.track').forEach(el => {
        el.onclick = () => {
          const idx = parseInt(el.dataset.i);
          loadTrack(station, idx, true);
        };
      });
    }

    function loadTrack(station, idx, autoplay) {
      if (idx < 0 || idx >= station.tracks.length) return;

      // Switch active station
      if (activeStation && activeStation !== station) {
        activeStation.title.textContent = '--';
        activeStation.currentIdx = -1;
        render(activeStation);
      }
      activeStation = station;
      station.currentIdx = idx;

      // Update shufflePos to match current track if in shuffle mode
      if (station.shuffleOn) {
        const pos = station.shuffleOrder.indexOf(idx);
        if (pos >= 0) station.shufflePos = pos;
      }

      // Move audio element to this station's player
      audio.pause();
      audio.style.display = '';
      station.container.appendChild(audio);

      const track = station.tracks[idx];
      station.title.textContent = track.title;

      // Clear any pending play handlers
      audio.oncanplay = null;
      audio.onerror = null;

      audio.src = `${station.path}/${encodeURIComponent(track.file)}`;

      if (autoplay) {
        audio.oncanplay = () => {
          audio.oncanplay = null;
          audio.play().catch(() => {});
        };
        audio.onerror = () => {
          audio.onerror = null;
          // Skip to next track on error
          setTimeout(() => move(station, 1), 100);
        };
      }

      render(station);
    }

    function move(station, dir) {
      if (!station.tracks.length) return;

      let newIdx;
      if (station.shuffleOn) {
        station.shufflePos = (station.shufflePos + dir + station.shuffleOrder.length) % station.shuffleOrder.length;
        if (station.shufflePos === 0 && dir > 0) {
          // Reshuffle when wrapping
          station.shuffleOrder = shuffle([...Array(station.tracks.length).keys()]);
        }
        newIdx = station.shuffleOrder[station.shufflePos];
      } else {
        // Sequential order by index
        const current = station.currentIdx >= 0 ? station.currentIdx : 0;
        newIdx = (current + dir + station.tracks.length) % station.tracks.length;
      }
      loadTrack(station, newIdx, true);
    }

    function preloadStation(station) {
      if (!station.tracks.length) return;
      // Always reload to ensure audio element is properly attached and loaded
      const idx = station.shuffleOn ? station.shuffleOrder[station.shufflePos] : 0;
      loadTrack(station, idx, false);
    }

    audio.addEventListener('ended', () => {
      if (activeStation) setTimeout(() => move(activeStation, 1), 100);
    });

    // Initialize
    stationConfigs.forEach(cfg => {
      stations[cfg.id] = initStation(cfg);
    });

    // Handle initial hash after stations exist
    if (location.hash) {
      showSection(location.hash.slice(1));
    }

    // Global keyboard controls on music tab
    document.addEventListener('keydown', (e) => {
      if (!document.getElementById('music').classList.contains('active')) return;
      if (e.code === 'Space') {
        e.preventDefault();
        if (audio.paused) {
          audio.play().catch(() => {});
        } else {
          audio.pause();
        }
      } else if (e.code === 'ArrowRight' && activeStation) {
        e.preventDefault();
        move(activeStation, 1);
      } else if (e.code === 'ArrowLeft' && activeStation) {
        e.preventDefault();
        move(activeStation, -1);
      }
    });
  </script>
</body>
</html>
